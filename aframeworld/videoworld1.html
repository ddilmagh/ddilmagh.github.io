<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Videosphere</title>
  <!-- A-Frame Library from Official CDN -->
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
  <!-- Bitmovin Player JS -->
  <script src="https://cdn.bitmovin.com/player/web/8/bitmovinplayer.js"></script>
</head>
<body>
  <a-scene>
    <a-assets>
      <!-- Define the video element for A-Frame -->
      <video id="aframeVideo" autoplay loop crossorigin="anonymous"></video>
    </a-assets>
    <a-videosphere src="#aframeVideo"></a-videosphere>
    <a-camera>
      <a-cursor raycaster="objects: .interactive"></a-cursor>
    </a-camera>
  </a-scene>

  <!-- Invisible Bitmovin Player container -->
  <div id="bitmovin-player" style="width: 0; height: 0; visibility: hidden;"></div>

  <!-- Play Button -->
  <button id="playButton" style="position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);">
    Play Video
  </button>

  <!-- Sound Toggle Button -->
  <button id="soundToggleButton" style="position: fixed; bottom: 60px; left: 50%; transform: translateX(-50%); display: none;">
    Mute Sound
  </button>

  <script>
    var player;
    var playerConfig = {
      key: 'YOUR_KEY', // Replace 'YOUR_KEY' with your Bitmovin player key
      source: {
        dash: 'YOUR_DASH_URL', // Replace with your DASH stream URL
        hls: 'YOUR_HLS_URL', // Replace with your HLS stream URL
        poster: 'YOUR_POSTER_URL' // Optional: Replace with your video poster URL
      },
      playback: {
        autoplay: false, // Autoplay is set to false initially
        muted: true // Starting muted to allow for autoplay on most browsers
      }
    };

    var playerContainer = document.getElementById('bitmovin-player');
    player = new bitmovin.player.Player(playerContainer, playerConfig);

    document.getElementById('playButton').addEventListener('click', function() {
      player.load(playerConfig.source).then(function() {
        console.log('Successfully loaded the stream.');
        var aframeVideo = document.getElementById('aframeVideo');
        var videoElement = playerContainer.getElementsByTagName('video')[0];
        if ('srcObject' in aframeVideo) {
          aframeVideo.srcObject = videoElement.captureStream();
        } else {
          // Older browsers may not support srcObject
          aframeVideo.src = URL.createObjectURL(videoElement.captureStream());
        }
        aframeVideo.play().then(() => {
          // Hide the play button once the video starts
          document.getElementById('playButton').style.display = 'none';
          // Show the sound toggle button
          document.getElementById('soundToggleButton').style.display = 'block';
        }).catch((e) => {
          console.error('Error playing the video:', e);
        });
      }).catch(function(error) {
        console.error('Error loading the stream:', error);
      });
    });

    document.getElementById('soundToggleButton').addEventListener('click', function() {
      player.isMuted().then((muted) => {
        if (muted) {
          player.unmute();
          this.textContent = 'Mute Sound';
        } else {
          player.mute();
          this.textContent = 'Unmute Sound';
        }
      }).catch(function(error) {
        console.error('Error while toggling mute state:', error);
      });
    });
  </script>
</body>
</html>

